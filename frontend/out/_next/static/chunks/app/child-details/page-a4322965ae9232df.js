(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[652],{2643:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>c});var l=t(5155),r=t(2115),o=t(6046),s=t(6702),n=t(9506);let i=()=>{let e=(0,o.useRouter)(),a=(0,o.useSearchParams)(),i=a.get("job_type")||"story",c=a.get("book_id")||"story1",[d,u]=(0,r.useState)(""),[p,g]=(0,r.useState)(""),[m,b]=(0,r.useState)([]),[h,x]=(0,r.useState)(null),[f,w]=(0,r.useState)(!1);(0,r.useEffect)(()=>()=>{m.forEach(e=>URL.revokeObjectURL(e.preview))},[m]);let j=async e=>{if("image/heic"===e.type||e.name.toLowerCase().endsWith(".heic"))try{console.info("\uD83D\uDCCC Converting HEIC to JPEG: ".concat(e.name));let a=(await t.e(0).then(t.t.bind(t,7712,23))).default,l=await a({blob:e,toType:"image/jpeg",quality:.8});if(!l)throw Error("HEIC conversion failed");let r=new File([l],e.name.replace(/\.heic$/i,".jpg"),{type:"image/jpeg"});return console.log("✅ HEIC converted successfully:",r),{file:r,preview:URL.createObjectURL(r)}}catch(e){return console.error("❌ HEIC conversion failed:",e),x("HEIC conversion failed. Please try another image."),null}return console.log("✅ Supported format detected: ".concat(e.name)),{file:e,preview:URL.createObjectURL(e)}},y=(0,r.useCallback)(async e=>{if(m.length+e.length>3){console.warn("⚠️ Too many images uploaded"),x("You can upload a maximum of 3 images.");return}x(null);let a=(await Promise.all(e.map(j))).filter(e=>null!==e);b(e=>[...e,...a].slice(0,3))},[m]),{getRootProps:v,getInputProps:k}=(0,s.VB)({accept:{"image/*":[]},multiple:!0,maxFiles:3,onDrop:y}),_=async a=>{if(a.preventDefault(),!d.trim()||!p){console.warn("⚠️ Missing form fields"),x("Please fill all fields.");return}if(0===m.length){console.warn("⚠️ No images uploaded"),x("Please upload at least 1 image.");return}x(null),w(!0);try{let a=new FormData;a.append("name",d.trim().charAt(0).toUpperCase()+d.trim().slice(1)),a.append("gender",p.toLowerCase()),a.append("job_type",i),m.forEach(e=>{let{file:t}=e;return a.append("images",t)}),console.log("\uD83D\uDCE4 Sending form data to /store-user-details");let t=await fetch("https://diffrun.com/store-user-details",{method:"POST",body:a});if(!t.ok){let e=await t.json();throw Error(e.detail||"Failed to upload images")}let l=await t.json();console.log("✅ User details stored:",l),console.log("\uD83D\uDCE4 Triggering workflow execution");let r=await fetch("https://diffrun.com/execute-workflow",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({job_id:l.job_id,name:d.trim(),gender:p.toLowerCase(),job_type:i,book_id:c}).toString()});if(!r.ok){let e=await r.text();throw Error("Failed to start workflow: ".concat(e))}console.log("\uD83D\uDD01 Redirecting to preview in 1.5s"),setTimeout(()=>{e.push("/preview?job_id=".concat(l.job_id,"&job_type=").concat(i,"&name=").concat(encodeURIComponent(d),"&gender=").concat(p,"&book_id=").concat(c,"&approve=false&paid=false"))},1500)}catch(e){console.error("❌ Submission error:",e),x(e.message||"An error occurred. Please try again.")}finally{w(!1)}};return(0,l.jsxs)("main",{className:"w-full min-h-screen flex flex-col items-center bg-white py-12 px-4 sm:px-8",children:[(0,l.jsxs)("div",{className:"text-center mb-16",children:[(0,l.jsx)("h2",{className:"text-4xl font-bold text-black leading-tight mb-4",children:"Fill out the form to get started"}),(0,l.jsx)("p",{className:"text-xl text-gray-700",children:"Let's create something magical together ✨"})]}),(0,l.jsxs)("form",{onSubmit:_,className:"bg-white p-8 rounded-lg shadow-[4px_4px_0px_rgba(0,0,0,0.8)] max-w-lg w-full space-y-8 border-2 border-black",children:[(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)("label",{htmlFor:"name",className:"block text-lg font-semibold text-black",children:"First Name"}),(0,l.jsx)("input",{type:"text",id:"name",value:d,onChange:e=>u(e.target.value),required:!0,disabled:f,className:"block w-full px-4 py-3 text-lg border-2 border-black focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-black bg-gray-100 rounded-sm placeholder-gray-500",placeholder:"Enter your first name"})]}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)("label",{className:"block text-lg font-semibold text-black",children:"Select Gender"}),(0,l.jsxs)("select",{id:"gender",value:p,onChange:e=>g(e.target.value),required:!0,disabled:f,className:"block w-full px-4 py-3 text-lg border-2 border-black focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-black bg-gray-100 rounded-sm appearance-none",children:[(0,l.jsx)("option",{value:"",children:"Select"}),(0,l.jsx)("option",{value:"boy",children:"Boy"}),(0,l.jsx)("option",{value:"girl",children:"Girl"})]})]}),(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsx)("label",{className:"block text-lg font-semibold text-black",children:"Upload Images"}),(0,l.jsxs)("div",{...v(),className:"border-2 border-dashed border-black p-6 rounded-lg text-center bg-gray-50 hover:bg-gray-100 cursor-pointer",children:[(0,l.jsx)("input",{...k()}),(0,l.jsxs)("p",{className:"text-black font-medium",children:["Drag & drop up to 3 images or ",(0,l.jsx)("span",{className:"underline",children:"browse files"})]})]}),m.length>0&&(0,l.jsx)("div",{className:"grid grid-cols-3 gap-3",children:m.map((e,a)=>(0,l.jsxs)("div",{className:"relative border-2 border-black rounded-lg shadow-[4px_4px_0px_rgba(0,0,0,0.8)]",children:[(0,l.jsx)("img",{src:e.preview,alt:"preview",className:"w-full h-24 object-contain rounded-lg"}),(0,l.jsx)("button",{type:"button",onClick:()=>b(m.filter((e,t)=>t!==a)),className:"absolute top-1 right-1 bg-black text-white text-sm rounded-full px-2 py-1 shadow-lg","aria-label":"Remove image ".concat(a+1),children:"✕"})]},a))})]}),(0,l.jsx)("div",{className:"bg-gray-50 border-2 border-black p-4 rounded-lg shadow-[4px_4px_0px_rgba(0,0,0,0.8)]",children:(0,l.jsxs)("ul",{className:"list-none pl-5 text-black space-y-2",children:[(0,l.jsx)("li",{children:"\uD83D\uDC64 Only one person in the photo"}),(0,l.jsx)("li",{children:"\uD83D\uDE0A Images where the face is clearly visible"}),(0,l.jsx)("li",{children:"\uD83D\uDEAB Avoid wearing sunglasses or hats"})]})}),(0,l.jsx)("button",{type:"submit",disabled:!d||!p||m.length<1||m.length>3||f,className:"w-full py-3 text-lg font-bold bg-indigo-500 text-white border-2 border-black rounded-sm shadow-[4px_4px_0px_rgba(0,0,0,0.8)] transition-all duration-200 ".concat(f?"cursor-not-allowed":"hover:bg-indigo-600"),children:f?"Processing...":"Preview your book"}),(0,l.jsxs)("p",{className:"text-gray-800 text-center font-bold flex items-center justify-center gap-2",children:[(0,l.jsx)("span",{children:"We follow strict data privacy standards"}),(0,l.jsx)(n.sqy,{className:"text-xl"})]}),h&&(0,l.jsx)("div",{className:"bg-red-50 text-red-600 border-2 border-black p-4 rounded-lg mt-4 shadow-[4px_4px_0px_rgba(0,0,0,0.8)]",children:h})]})]})};function c(){return(0,l.jsx)(r.Suspense,{fallback:(0,l.jsx)("div",{children:"Loading..."}),children:(0,l.jsx)(i,{})})}},3007:(e,a,t)=>{Promise.resolve().then(t.bind(t,2643))}},e=>{var a=a=>e(e.s=a);e.O(0,[753,383,441,587,358],()=>a(3007)),_N_E=e.O()}]);