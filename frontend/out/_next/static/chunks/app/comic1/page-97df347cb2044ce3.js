(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[527],{3471:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>l});var a=r(5155),o=r(2115),n=r(6046);let i=()=>{let e=(0,n.useSearchParams)().get("job_id"),[t,r]=(0,o.useState)(null),[i,l]=(0,o.useState)(!0),[s,c]=(0,o.useState)(null),[d,u]=(0,o.useState)(!1),[m,f]=(0,o.useState)(null);(0,o.useEffect)(()=>{(async()=>{if(!e){c("Missing job ID."),l(!1);return}try{if(!(await fetch("https://diffrun.com/run-combined-workflow",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({job_id:e})})).ok)throw Error("Failed to start combined workflow")}catch(e){console.error("Failed to run combined workflow:",e.message),c("An error occurred while generating your comic."),l(!1);return}try{let t=async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;for(let a=0;a<t;a++){let t=await fetch("https://diffrun.com/get-combined-image?job_id=".concat(e));if(t.ok){let e=await t.json();r(e.image),l(!1);return}await new Promise(e=>setTimeout(e,2e3))}throw Error("Timeout waiting for combined image")};await t()}catch(e){console.error("Error fetching collage image:",e.message),c("Could not retrieve your comic collage."),l(!1)}})()},[e]);let h=async()=>{if(e){u(!0),f(null);try{let t=await fetch("https://diffrun.com/generate-comic-pdf?job_id=".concat(e));if(!t.ok)throw Error("PDF generation failed");let r=await t.blob(),a=window.URL.createObjectURL(r),o=document.createElement("a");o.href=a,o.download="comic-collage.pdf",document.body.appendChild(o),o.click(),window.URL.revokeObjectURL(a),document.body.removeChild(o)}catch(e){console.error("PDF generation failed:",e),f("Failed to generate PDF. Please try again.")}finally{u(!1)}}};return(0,a.jsxs)("main",{className:"bg-gray-100 min-h-screen flex flex-col items-center justify-center px-4 py-12",children:[(0,a.jsx)("h1",{className:"text-3xl md:text-4xl font-bold text-center text-indigo-600 mb-6",children:"Your Comic"}),i?(0,a.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,a.jsx)("div",{className:"animate-spin h-10 w-10 border-4 border-indigo-500 border-t-transparent rounded-full"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Generating your comic collage..."})]}):s?(0,a.jsx)("p",{className:"text-red-600 text-center",children:s}):t?(0,a.jsxs)("div",{className:"w-full max-w-4xl shadow-lg rounded-xl overflow-hidden border bg-white",children:[(0,a.jsx)("img",{src:t,alt:"Your Comic Collage",className:"w-full object-contain"}),(0,a.jsxs)("div",{className:"p-4 border-t border-gray-100",children:[(0,a.jsxs)("button",{"aria-label":"Download PDF",onClick:h,disabled:d,className:"w-full bg-indigo-600 text-white px-6 py-3 rounded-lg font-medium hover:bg-indigo-700 transition disabled:bg-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-300 relative",children:[d&&(0,a.jsx)("div",{className:"absolute left-0 top-0 h-full w-2 bg-purple-500 animate-pulse"}),(0,a.jsx)("span",{className:"relative z-10",children:d?"Generating PDF...":"Download PDF"})]}),m&&(0,a.jsx)("p",{className:"text-red-600 text-sm mt-2 text-center",children:m})]})]}):(0,a.jsx)("p",{className:"text-gray-600",children:"No image found."})]})};function l(){return(0,a.jsx)(o.Suspense,{fallback:(0,a.jsx)("div",{children:"Loading..."}),children:(0,a.jsx)(i,{})})}},5116:(e,t,r)=>{Promise.resolve().then(r.bind(r,3471))},6046:(e,t,r)=>{"use strict";var a=r(6658);r.o(a,"useRouter")&&r.d(t,{useRouter:function(){return a.useRouter}}),r.o(a,"useSearchParams")&&r.d(t,{useSearchParams:function(){return a.useSearchParams}})}},e=>{var t=t=>e(e.s=t);e.O(0,[441,587,358],()=>t(5116)),_N_E=e.O()}]);